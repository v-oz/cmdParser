# Financisto

## Что это?

Вполне рабочий пример парсера, встроенного в [Tasker](tasker.dinglisch.net/index.html) для обработки СМС-оповещений банка о транзакциях по карте (картам)

## Как это?

СБ РФ в оповещениях в начале сообщения указывает тип карты и последние четыре цифры её номера.
Tasker читает входящие СМС, фильтрует по отправителю и, при желании, содержимому.
Текст подходящего под критерии фильтра сообщения передаётся парсеру.
Парсер, выбрав одну команду, запускает СУБД sqlite3 для внесения транзакции в БД приложения [Financisto](http://4pda.ru/forum/index.php?showtopic=141782)

## Файлы

- task.txt - описание профилей и задач в Tasker
- financisto.sql - SQL запрос в БД
- financisto.cmd.js - парсер команд для Financisto

## Настройка

Указанные в начале сообщения тип карты и последние четыре цифры её номера используются для запуска системы.

Для типовых операций в СМС обычно пишутся типовые слова, которые можно использовать, как ключевые для настройки наборов и команд.
При внесении транзакции в БД Financisto, есть возможность выбрать шаблон транзакции или заполнить определенные поля значениями, считанными из сообщения.

Таким образом, если есть типовые операции (категории), совершаемые периодически (коммунальные платежи, связь, пр.), 
то под эти операции настраиваются специальные команды, заполняющие специфические поля транзакций или использующие шаблоны транзакций.
Для прочих операций этого типа настраиваются команды по умолчанию, заполняющие минимум полей.

## Алгоритм

Среда, вызывает функцию парсера с входным текстом в качестве параметра. На уровне системы производится выбор категории транзакций и спуск на уровень набора команд.

В этих командах производится выборка необходимых данных из СМС, заполнение необходимых переменных (свойств объекта. см. financisto.cmd.js) и запуск функции внесения данных в БД.
